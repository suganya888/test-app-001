<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/plain" id="mit-license">
MIT License

Copyright (c) 2023 Your Name or Organization

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A clean, simple, and functional web-based calculator application for basic arithmetic operations. Designed for ease of use and quick calculations.">
    <title>Simple Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f2f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .calculator {
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 25px;
            width: 320px;
            max-width: 90%;
            border: 1px solid #e0e0e0;
        }
        #display {
            width: 100%;
            height: 70px;
            background-color: #e9ecef;
            border: none;
            border-radius: 10px;
            margin-bottom: 20px;
            padding: 10px 20px;
            font-size: 2.5em;
            text-align: right;
            color: #343a40;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        .btn {
            height: 60px;
            font-size: 1.5em;
            border-radius: 10px;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.12);
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .btn-info {
            background-color: #17a2b8;
            color: white;
        }
        .btn-info:hover {
            background-color: #117a8b;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }
        .btn-warning:hover {
            background-color: #e0a800;
        }
        /* Make the '0' button span two columns */
        .btn[data-value="0"] {
            grid-column: span 2;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <input type="text" id="display" class="form-control" value="0" readonly>
        <div class="buttons-grid">
            <!-- Memory Row -->
            <button class="btn btn-secondary" id="memory-clear" data-type="memory-function" data-value="mc">MC</button>
            <button class="btn btn-secondary" id="memory-recall" data-type="memory-function" data-value="mr">MR</button>
            <button class="btn btn-secondary" id="memory-subtract" data-type="memory-function" data-value="m-">M-</button>
            <button class="btn btn-secondary" id="memory-add" data-type="memory-function" data-value="m+">M+</button>

            <!-- Row 1 -->
            <button class="btn btn-danger" id="clear">C</button>
            <button class="btn btn-secondary" data-type="unary-operator" data-value="%">%</button>
            <button class="btn btn-secondary" data-type="unary-operator" data-value="sqrt">√</button>
            <button class="btn btn-secondary" data-type="operator" data-value="/">/</button>

            <!-- Row 2 -->
            <button class="btn btn-primary" data-type="number" data-value="7">7</button>
            <button class="btn btn-primary" data-type="number" data-value="8">8</button>
            <button class="btn btn-primary" data-type="number" data-value="9">9</button>
            <button class="btn btn-secondary" data-type="operator" data-value="*">×</button>

            <!-- Row 3 -->
            <button class="btn btn-primary" data-type="number" data-value="4">4</button>
            <button class="btn btn-primary" data-type="number" data-value="5">5</button>
            <button class="btn btn-primary" data-type="number" data-value="6">6</button>
            <button class="btn btn-secondary" data-type="operator" data-value="-">-</button>

            <!-- Row 4 -->
            <button class="btn btn-primary" data-type="number" data-value="1">1</button>
            <button class="btn btn-primary" data-type="number" data-value="2">2</button>
            <button class="btn btn-primary" data-type="number" data-value="3">3</button>
            <button class="btn btn-secondary" data-type="operator" data-value="+">+</button>

            <!-- Row 5 -->
            <button class="btn btn-primary" data-type="number" data-value="0">0</button>
            <button class="btn btn-warning" id="decimal" data-type="decimal" data-value=".">.</button>
            <button class="btn btn-info" id="equals">=</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const display = document.getElementById('display');
            const buttonsGrid = document.querySelector('.buttons-grid');
            let currentInput = '0';
            let firstOperand = null;
            let operator = null;
            let waitingForSecondOperand = false; // True if an operator was just pressed or equals, next number replaces currentInput
            let hasSecondOperandBeenEntered = false; // True if digits/MR/unary op provided a second operand after an operator
            let memory = 0; // Calculator memory

            function updateDisplay() {
                display.value = currentInput;
            }

            function clearCalculator() {
                currentInput = '0';
                firstOperand = null;
                operator = null;
                waitingForSecondOperand = false;
                hasSecondOperandBeenEntered = false; // Reset this flag too
                updateDisplay();
            }

            function inputDigit(digit) {
                if (waitingForSecondOperand === true) {
                    currentInput = digit;
                    waitingForSecondOperand = false;
                    hasSecondOperandBeenEntered = true; // A new second operand is being typed
                } else {
                    currentInput = currentInput === '0' ? digit : currentInput + digit;
                }
                updateDisplay();
            }

            function inputDecimal(dot) {
                if (waitingForSecondOperand === true) {
                    currentInput = '0.';
                    waitingForSecondOperand = false;
                    hasSecondOperandBeenEntered = true; // Decimal starts a new second operand
                    updateDisplay();
                    return;
                }
                if (!currentInput.includes(dot)) {
                    currentInput += dot;
                }
                updateDisplay();
            }

            function handleOperator(nextOperator) {
                const inputValue = parseFloat(currentInput);

                if (operator && waitingForSecondOperand) {
                    // Allows changing operator (e.g., 5 + - becomes 5 -)
                    operator = nextOperator;
                    updateDisplay();
                    return;
                }

                if (firstOperand === null) {
                    firstOperand = inputValue;
                } else if (operator) {
                    // Chained operation (e.g., 5 + 3 -)
                    // If an operator was pending and a second operand was entered, calculate
                    if (hasSecondOperandBeenEntered || !waitingForSecondOperand) { // Ensure calculation happens if second operand was typed or provided by MR/unary
                        const result = performCalculation[operator](firstOperand, inputValue);
                        currentInput = String(result);
                        firstOperand = result;
                    }
                }

                waitingForSecondOperand = true;
                hasSecondOperandBeenEntered = false; // Operator was just pressed, waiting for new second operand
                operator = nextOperator;
                updateDisplay();
            }

            function handleUnaryOperator(unaryOp) {
                let inputValue = parseFloat(currentInput);

                if (isNaN(inputValue)) {
                    display.value = 'Error';
                    alert("Invalid input for operation.");
                    clearCalculator();
                    return;
                }

                let result;
                if (unaryOp === 'sqrt') {
                    if (inputValue < 0) {
                        display.value = 'Error';
                        alert("Error: Cannot calculate square root of a negative number!");
                        clearCalculator();
                        return;
                    }
                    result = Math.sqrt(inputValue);
                } else if (unaryOp === '%') {
                    if (operator && firstOperand !== null) {
                        result = firstOperand * (inputValue / 100);
                    } else {
                        result = inputValue / 100;
                    }
                }
                
                currentInput = String(result);
                updateDisplay();
                waitingForSecondOperand = false; // After unary op, the result can be extended by new digits.
                // If an operator was pending, this unary op result IS the second operand.
                if (operator && firstOperand !== null) {
                    hasSecondOperandBeenEntered = true;
                }
            }

            function memoryClear() {
                memory = 0;
            }

            function memoryRecall() {
                currentInput = String(memory);
                waitingForSecondOperand = true; // Next digit replaces memory value
                // If an operator is pending, MR *provides* the second operand.
                if (operator && firstOperand !== null) {
                    hasSecondOperandBeenEntered = true;
                } else {
                    // If no operator pending, MR is like entering a new number.
                    // The next digit should still replace it.
                    hasSecondOperandBeenEntered = false; // No pending op means no "second operand" context.
                }
                updateDisplay();
            }

            function memoryAdd() {
                const inputValue = parseFloat(currentInput);
                if (!isNaN(inputValue)) {
                    memory += inputValue;
                }
            }

            function memorySubtract() {
                const inputValue = parseFloat(currentInput);
                if (!isNaN(inputValue)) {
                    memory -= inputValue;
                }
            }

            const performCalculation = {
                '/': (first, second) => {
                    if (second === 0) {
                        display.value = 'Error';
                        alert("Error: Division by zero!");
                        clearCalculator();
                        return '0';
                    }
                    return first / second;
                },
                '*': (first, second) => first * second,
                '+': (first, second) => first + second,
                '-': (first, second) => first - second
            };

            buttonsGrid.addEventListener('click', (event) => {
                const { target } = event;

                if (!target.matches('button')) {
                    return;
                }

                if (target.id === 'clear') {
                    clearCalculator();
                    return;
                }

                if (target.id === 'equals') {
                    if (firstOperand === null || operator === null) {
                        return;
                    }

                    let inputValue = parseFloat(currentInput);
                    let result;

                    if (waitingForSecondOperand && !hasSecondOperandBeenEntered) {
                        // This scenario occurs when an operator was just pressed (e.g., '5 +'),
                        // and NO new digits, MR, or unary ops were entered.
                        // So, the user is likely chaining like '5 + =', meaning 5 + 5.
                        result = performCalculation[operator](firstOperand, firstOperand);
                    } else {
                        // New second operand was entered (e.g., '5 + 3')
                        // OR MR was pressed (e.g., '5 + MR')
                        // OR a unary op was applied to the second operand (e.g., '5 + 9 sqrt')
                        result = performCalculation[operator](firstOperand, inputValue);
                    }

                    currentInput = String(result);
                    firstOperand = null; // Reset for new calculation
                    operator = null; // Reset operator
                    waitingForSecondOperand = true; // Set to true so next number typed replaces this result
                    hasSecondOperandBeenEntered = false; // Reset for next calculation
                    updateDisplay();
                    return;
                }

                if (target.dataset.type === 'number') {
                    inputDigit(target.dataset.value);
                    return;
                }

                if (target.dataset.type === 'decimal') {
                    inputDecimal(target.dataset.value);
                    return;
                }

                if (target.dataset.type === 'operator') {
                    handleOperator(target.dataset.value);
                    return;
                }

                if (target.dataset.type === 'unary-operator') {
                    handleUnaryOperator(target.dataset.value);
                    return;
                }

                if (target.dataset.type === 'memory-function') {
                    const memFunc = target.dataset.value;
                    if (memFunc === 'mc') {
                        memoryClear();
                    } else if (memFunc === 'mr') {
                        memoryRecall();
                    } else if (memFunc === 'm+') {
                        memoryAdd();
                    } else if (memFunc === 'm-') {
                        memorySubtract();
                    }
                    return;
                }
            });

            // Initialize display
            updateDisplay();
        });
    </script>
</body>
</html>